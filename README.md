# Virtual Devices Multi - Home Assistant Integration

[![hacs_badge](https://img.shields.io/badge/HACS-Default-41BDF5.svg?style=for-the-badge)](https://github.com/hacs/integration)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![HA Version](https://img.shields.io/badge/HA-2025.10.0+-blue.svg)](https://www.home-assistant.io/)
[![Quality Scale](https://img.shields.io/badge/Quality%20Scale-Silver-orange.svg)](https://hacs.xyz/docs/publishing/quality-guideline)

这是一个符合 Home Assistant 2025.10.0 标准的自定义集成，允许您创建虚拟设备，**一个设备下可以包含多个实体**，适用于测试、演示和开发目的。

## 🎯 核心特性

- ✅ **一设备多实体**：一个设备下可创建多个相同类型的实体
- ✅ **按钮类型支持**：支持虚拟按钮实体
- ✅ **模板功能**：支持传感器和其他实体的模板配置，可动态计算数值
- ✅ **图形化配置**：通过 Web 界面轻松添加和配置
- ✅ **设备信息**：完整的设备信息和实体类别支持
- ✅ **HA 2025.10.0标准**：采用最新API和最佳实践
- ✅ **多语言支持**：中文和英文界面
- ✅ **HACS兼容**：符合HACS质量标准

## 📦 支持的设备类型（18种）

| 设备类型 | 代码标识 | 主要功能 |
|---------|---------|----------|
| 🔆 灯光 | `light` | 亮度、色温、RGB颜色、灯效 |
| 🔌 开关 | `switch` | 基本开关控制 |
| 🎮 按钮 | `button` | 通用、重启、更新、识别按钮 |
| ❄️ 空调 | `climate` | 温度控制、多种模式、风速调节 |
| 🪟 窗帘 | `cover` | 8种类型、位置控制 |
| 💨 风扇 | `fan` | 速度控制、预设模式、摆动 |
| 📊 传感器 | `sensor` | 16种环境、电力、空气质量监测 |
| 🚨 二进制传感器 | `binary_sensor` | 13种状态监测 |
| 📺 媒体播放器 | `media_player` | 6种类型、播放控制 |
| 🤖 扫地机器人 | `vacuum` | 清洁模式、充电、状态监控 |
| 🌤️ 气象站 | `weather` | 完整天气信息和预报 |
| 📹 摄像头 | `camera` | 5种类型、图像生成 |
| 🔒 智能门锁 | `lock` | 4种类型、锁定控制 |
| 🚰 水阀 | `valve` | 4种类型、流量控制 |
| 🔋 热水器 | `water_heater` | 5种加热模式 |
| 💧 加湿器 | `humidifier` | 5种加湿模式 |
| 🌬️ 空气净化器 | `air_purifier` | 6种净化模式、AQI监测 |
| 🎬 场景 | `scene` | 多设备状态联动 |

### 🔆 灯光 (Light)
- 支持亮度调节
- 支持色温调节
- 支持 RGB 颜色
- 支持灯效模式（彩虹、闪烁、呼吸等）
- 每项功能可选择性启用

### 🔌 开关 (Switch)
- 简单的开关控制
- 状态持久化
- 适用于各种虚拟开关场景

### 🎮 按钮 (Button)
- 通用按钮
- 重启按钮
- 更新按钮
- 识别按钮
- 按下时触发事件供自动化使用

### ❄️ 空调 (Climate)
- 温度控制（可配置范围）
- 多种工作模式（制热、制冷、自动、除湿、送风）
- 风速调节（自动、低速、中速、高速）
- 摆风控制（垂直、水平、全部）

### 🪟 窗帘 (Cover)
- 8种窗帘类型（窗帘、百叶窗、车库门等）
- 位置控制（0-100%）
- 开启、关闭、停止功能

### 💨 风扇 (Fan)
- 速度控制（百分比）
- 预设模式（睡眠、自然风、强风）
- 摆动功能
- 方向控制（正转/反转）

### 📊 传感器 (Sensor)
支持16种传感器类型：
- 环境监测：温度、湿度、压力、照度
- 电力监测：功率、电量、电压、电流、电池
- 空气质量：PM2.5、PM10、CO2、VOC、甲醛
- 其他：信号强度、噪音、紫外线指数、降雨量、风速、水质、pH值

### 🚨 二进制传感器 (Binary Sensor)
支持13种传感器类型：
- 人体感应、门磁、窗磁
- 烟雾、燃气、湿度
- 占用、存在、故障
- 安全、声音、震动

### 📺 媒体播放器 (MediaPlayer)
支持6种媒体播放器类型：
- 电视、音响、接收器
- 流媒体设备、游戏机、电脑
- 支持播放、暂停、停止、切换曲目
- 音量控制、静音、重复/随机播放
- 媒体源切换和模板支持

### 🤖 扫地机器人 (Vacuum)
支持完整的扫地机器人功能：
- 清洁、暂停、停止、返回充电座
- 定点清洁、局部清洁、房间清洁
- 多档风速调节（安静到强力）
- 电池电量监控和自动充电
- 清洁历史和面积统计
- 实时状态模拟和运动检测

### 🌤️ 气象站 (Weather)
提供完整的天气信息：
- 实时天气状况和温度
- 湿度、气压、风速、能见度
- 露点温度、紫外线指数、降水量
- 5天天气预报和空气质量指数
- 基于时间和季节的智能模拟

### 📹 摄像头 (Camera)
支持5种摄像头类型：
- 室内摄像头、室外摄像头
- 门铃摄像头、云台摄像头、婴儿监护器
- 动态图像生成（支持多种分辨率）
- 运动检测和录像功能
- PTZ控制（仅云台型号）
- 夜视功能和音频支持

### 🔒 智能门锁 (Lock)
支持4种锁类型：
- 门栓锁、门锁、挂锁、智能锁
- 开锁/关锁状态控制
- 访问密码验证
- 自动锁定和延迟设置
- 电池电量监控
- 锁状态变化事件


### 🚰 水阀 (Valve)
支持4种阀门类型：
- 水阀、燃气阀、灌溉阀、区域阀
- 开/关控制和位置调节
- 流量计算和累计统计
- 压力监测和阀门状态
- 模拟渐变过程和位置反馈

### 🔋 热水器 (Water Heater)
支持热水器功能：
- 温度控制（可配置范围）
- 多种工作模式（电加热、燃气、太阳能、热泵）
- 预设温度和节能模式
- 状态监控和安全保护

### 💧 加湿器 (Humidifier)
支持加湿器功能：
- 湿度控制（可配置范围）
- 5种加湿模式（超声波、蒸发式、蒸汽、叶轮、暖雾）
- 目标湿度设定和自动调节
- 模式切换和状态监控
- 缺水保护和水位显示功能

### 🌬️ 空气净化器 (Air Purifier)
支持空气净化器功能：
- 空气质量自动调节
- 多种净化模式（HEPA、活性炭、UV-C、离子、臭氧、混合）
- 风速控制和滤网状态监控
- PM2.5、甲醛、VOC等污染物检测

### 🎬 场景 (Scene)
支持场景功能：
- 一键触发多个设备状态变化
- 支持灯光场景、窗帘场景、空调场景等
- 场景恢复和状态记忆
- 自动化集成支持


## 📥 安装方法

### 方法1：手动安装
1. 将整个 `virtual_devices` 文件夹复制到 Home Assistant 的 `custom_components` 目录
2. 重启 Home Assistant
3. 在集成页面搜索 "虚拟设备集成（多实体）" 并添加

### 方法2：通过 HACS 安装
1. 打开 HACS
2. 点击右上角菜单 → 自定义存储库
3. 添加此仓库 URL: https://github.com/ha-china/virtual_devices
4. 搜索 "虚拟设备集成（多实体）"
5. 安装并重启 HA

## 🚀 使用说明

### 添加设备

1. 进入 **配置 > 设备与服务**
2. 点击 **添加集成**
3. 搜索并选择 **虚拟设备集成（多实体）**
4. 按照向导配置：
   - **步骤1**：输入设备名称、选择设备类型、设置实体数量
   - **步骤2**：依次配置每个实体的名称和参数
5. 完成后，设备和所有实体会立即显示

### 配置示例

#### 示例1：开关设备（3个开关）
```
设备名称: 客厅开关面板
设备类型: 开关
实体数量: 3

实体1: 客厅主灯开关
实体2: 客厅氛围灯开关
实体3: 客厅插座开关
```

结果：创建1个设备，包含3个开关实体

#### 示例2：灯光设备（4个灯）
```
设备名称: 卧室灯光组
设备类型: 灯光
实体数量: 4

实体1: 卧室主灯（亮度+色温）
实体2: 床头灯（亮度+RGB）
实体3: 氛围灯条（RGB+灯效）
实体4: 夜灯（仅亮度）
```

结果：创建1个设备，包含4个不同配置的灯光实体

#### 示例3：按钮设备（5个按钮）
```
设备名称: 智能场景按钮
设备类型: 按钮
实体数量: 5

实体1: 回家模式按钮
实体2: 离家模式按钮
实体3: 睡眠模式按钮
实体4: 观影模式按钮
实体5: 全关按钮
```

结果：创建1个设备，包含5个按钮实体

## ⚙️ 高级功能

### 模板配置
支持以下设备类型的模板功能：
- 传感器：动态计算温度、湿度、功率等数值
- 二进制传感器：基于条件生成状态
- 媒体播放器：模板化媒体内容和状态
- 摄像头：动态生成图像内容

### 设备信息
每个虚拟设备包含：
- 制造商：Yunuo Intelligence
- 型号：Virtual Device Multi-Entity
- 版本：2025.10.0
- 支持自定义设备名称和实体ID

### 实体类别
传感器类实体自动归类为诊断类别，便于管理。

## 🛠️ 技术规格

- **兼容性**: Home Assistant 2025.10.0+
- **集成类型**: 设备集成
- **IoT类别**: 本地轮询
- **质量标准**: HACS Silver等级
- **依赖**: 无外部依赖
- **实体数量**: 每设备1-10个实体

## 🔧 故障排除

### 常见问题
1. **实体无法显示**：确保设备类型和实体配置正确
2. **模板不生效**：检查模板语法和引用的实体是否存在
3. **媒体播放器无声音**：虚拟设备不产生实际音频
4. **摄像头无图像**：需要等待图像生成完成

### 调试模式
在Home Assistant的配置中启用调试日志：
```yaml
logger:
  logs:
    custom_components.virtual_devices: debug
```

## 📞 支持

- **GitHub仓库**: https://github.com/ha-china/virtual_devices
- **问题反馈**: 请在GitHub Issues中提交
- **文档**: 查看Wiki获取更多使用说明

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🤝 贡献

欢迎提交Pull Request来改进这个项目！请确保：
- 遵循现有的代码风格
- 添加适当的测试
- 更新相关文档